function initHeader(){const e=document.getElementById("site-header");if(!e)return;const t=()=>{window.scrollY>10?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function initReadingProgress(){const e=document.getElementById("reading-progress-bar");if(!e)return;const t=()=>{const t=window.scrollY,o=document.documentElement.scrollHeight-window.innerHeight,n=o>0?t/o*100:0;e.style.width=`${Math.min(n,100)}%`};window.addEventListener("scroll",t,{passive:!0}),t()}function initMobileNav(){const e=document.getElementById("mobile-fixed-nav");if(!e)return;const t=e.querySelectorAll('a[href^="#"]:not(.mobile-nav-cta)'),o=[];t.forEach(e=>{const t=e.getAttribute("href").substring(1),n=document.getElementById(t);n&&o.push({link:e,section:n})});const n=()=>{const e=window.scrollY+200;let n=null;o.forEach(({link:t,section:o})=>{const i=o.offsetTop,s=i+o.offsetHeight;e>=i&&e<s&&(n=t)}),t.forEach(e=>e.classList.remove("active")),n&&n.classList.add("active")};window.addEventListener("scroll",n,{passive:!0}),n()}function initFAQ(){document.querySelectorAll(".faq-question").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".faq-item"),o=t.classList.contains("active");document.querySelectorAll(".faq-item.active").forEach(e=>{e!==t&&(e.classList.remove("active"),e.querySelector(".faq-question").setAttribute("aria-expanded","false"))}),t.classList.toggle("active"),e.setAttribute("aria-expanded",!o)})})}function initScrollAnimations(){const e=document.querySelectorAll("[data-aos]");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const o=e.target.dataset.aosDelay||0;setTimeout(()=>{e.target.classList.add("aos-animate")},o),t.unobserve(e.target)}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e.forEach((e,o)=>{const n=e.closest(".problems-grid, .service-grid, .cases-grid, .voices-grid, .faq-list");if(n){const t=n.querySelectorAll("[data-aos]"),o=Array.from(t).indexOf(e);e.dataset.aosDelay=80*o}t.observe(e)})}function initParticles(){const e=document.getElementById("hero-particles");if(!e)return;const t=["rgba(230, 57, 70, 0.3)","rgba(255, 140, 66, 0.3)","rgba(255, 255, 255, 0.15)","rgba(230, 57, 70, 0.15)"];for(let o=0;o<20;o++){const o=document.createElement("div");o.classList.add("particle");const n=6*Math.random()+2,i=100*Math.random(),s=15*Math.random()+10,c=15*Math.random(),r=t[Math.floor(Math.random()*t.length)];o.style.width=`${n}px`,o.style.height=`${n}px`,o.style.left=`${i}%`,o.style.bottom="-10px",o.style.background=r,o.style.animationDuration=`${s}s`,o.style.animationDelay=`${c}s`,e.appendChild(o)}}function initSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{const o=e.getAttribute("href");if("#"===o)return;const n=document.querySelector(o);if(!n)return;t.preventDefault();const i=document.getElementById("site-header")?.offsetHeight||0,s=n.getBoundingClientRect().top+window.scrollY-i;window.scrollTo({top:s,behavior:"smooth"})})})}function initForm(){const e=document.getElementById("contact-form"),t=document.getElementById("submit-btn"),o=document.getElementById("form-success"),n=document.getElementById("privacy-agree");e&&t&&o&&(n&&n.addEventListener("change",()=>{t.disabled=!n.checked}),e.addEventListener("submit",async i=>{if(i.preventDefault(),!n||n.checked)if(e.checkValidity()){t.disabled=!0,t.textContent="送信中...";try{const t=new FormData(e);if(!(await fetch(e.action,{method:"POST",body:t})).ok)throw new Error("送信に失敗しました");"function"==typeof gtag&&gtag("event","generate_lead",{event_category:"form",event_label:"free_diagnosis",monthly_sales:t.get("monthly_sales")||"",desired_services:t.getAll("desired_services[]").join(", ")||""}),e.style.display="none",o.style.display="block",o.scrollIntoView({behavior:"smooth",block:"center"})}catch(e){alert("送信に失敗しました。お手数ですが時間をおいてもう一度お試しください。"),t.disabled=!1,t.textContent="▶ 無料の店舗診断を申し込む"}}else e.reportValidity();else alert("個人情報の取り扱いに同意してください。")}))}function initStepForm(){const e=document.querySelectorAll(".step-next-btn"),t=document.querySelectorAll(".step-prev-btn");e.length&&(e.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".step-form-step"),o=e.dataset.next,n=document.getElementById(`step-${o}`);if("step-1"===t.id){const e=t.querySelector("select");if(e&&!e.value)return e.focus(),void e.reportValidity()}if(t&&n){t.classList.remove("active"),n.classList.add("active");const e=document.querySelector(".contact-form");if(e){const t=document.getElementById("site-header")?.offsetHeight||0,o=e.getBoundingClientRect().top+window.scrollY-t-16;window.scrollTo({top:o,behavior:"smooth"})}}})}),t.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".step-form-step"),o=e.dataset.prev,n=document.getElementById(`step-${o}`);if(t&&n){t.classList.remove("active"),n.classList.add("active");const e=document.querySelector(".contact-form");if(e){const t=document.getElementById("site-header")?.offsetHeight||0,o=e.getBoundingClientRect().top+window.scrollY-t-16;window.scrollTo({top:o,behavior:"smooth"})}}})}))}document.addEventListener("DOMContentLoaded",()=>{initHeader(),initReadingProgress(),initMobileNav(),initFAQ(),initScrollAnimations(),initParticles(),initSmoothScroll(),initForm(),initStepForm()});